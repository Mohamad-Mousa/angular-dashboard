<div class="card border-0 shadow-sm h-100">
  <div class="card-body">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-3 mb-4">
      <div>
        <p class="text-uppercase text-muted fw-semibold small mb-1">Generation</p>
        <h2 class="h4 mb-0">AI Policy Generator</h2>
      </div>
      @if (isGenerated) {
        <div class="d-flex gap-2">
          <app-button
            label="Save Policy"
            size="sm"
            variant="primary"
            icon="save"
            (click)="savePolicy()"
          ></app-button>
          <app-button
            label="Export PDF"
            size="sm"
            variant="outline"
            icon="picture_as_pdf"
            (click)="exportPolicy('pdf')"
          ></app-button>
          <app-button
            label="Export DOCX"
            size="sm"
            variant="outline"
            icon="description"
            (click)="exportPolicy('docx')"
          ></app-button>
        </div>
      }
    </div>

    <div class="alert alert-info mb-4" role="alert">
      <strong>How it works:</strong> Provide your context and readiness assessment results.
      The system will retrieve relevant international AI policies and generate a customized policy draft
      with citations, rationale, and references tailored to your needs.
    </div>

    @if (!showPreview) {
      <!-- Policy Context Form -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body">
          <h5 class="mb-4">Policy Context</h5>
          
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Sector <span class="text-danger">*</span></label>
              <select
                class="form-select"
                [(ngModel)]="policyContext.sector"
                [disabled]="isGenerating"
              >
                <option value="">Select sector</option>
                @for (option of sectorOptions; track option) {
                  <option [value]="option">{{ option }}</option>
                }
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Organization Size <span class="text-danger">*</span></label>
              <select
                class="form-select"
                [(ngModel)]="policyContext.organizationSize"
                [disabled]="isGenerating"
              >
                <option value="">Select size</option>
                @for (option of sizeOptions; track option) {
                  <option [value]="option">{{ option }}</option>
                }
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Risk Appetite <span class="text-danger">*</span></label>
              <select
                class="form-select"
                [(ngModel)]="policyContext.riskAppetite"
                [disabled]="isGenerating"
              >
                <option value="">Select risk appetite</option>
                @for (option of riskAppetiteOptions; track option) {
                  <option [value]="option">{{ option }}</option>
                }
              </select>
            </div>

            <div class="col-md-6">
              <label class="form-label">Implementation Timeline <span class="text-danger">*</span></label>
              <select
                class="form-select"
                [(ngModel)]="policyContext.timeline"
                [disabled]="isGenerating"
              >
                <option value="">Select timeline</option>
                @for (option of timelineOptions; track option) {
                  <option [value]="option">{{ option }}</option>
                }
              </select>
            </div>
          </div>

          <div class="mt-4">
            <app-button
              [label]="isGenerating ? 'Generating...' : 'Generate Policy'"
              size="md"
              variant="primary"
              icon="auto_awesome"
              [disabled]="!isFormValid() || isGenerating"
              (click)="generatePolicy()"
            ></app-button>
          </div>
        </div>
      </div>

      @if (isGenerating) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary mb-3" role="status">
            <span class="visually-hidden">Generating...</span>
          </div>
          <p class="text-muted">Generating your customized AI policy...</p>
        </div>
      }
    } @else {
      <!-- Policy Preview -->
      <div class="policy-preview">
        <div class="d-flex align-items-center justify-content-between mb-4">
          <button
            type="button"
            class="btn btn-link text-decoration-none p-0 d-flex align-items-center"
            (click)="showPreview = false"
          >
            <span class="material-symbols-rounded me-2">arrow_back</span>
            <span>Edit Context</span>
          </button>
        </div>

        <!-- Executive Summary -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body">
            <h5 class="mb-3 d-flex align-items-center">
              <span class="material-symbols-rounded me-2">summarize</span>
              <span>Executive Summary</span>
            </h5>
            <p class="mb-0">{{ executiveSummary }}</p>
          </div>
        </div>

        <!-- Policy Sections -->
        <div class="card border-0 shadow-sm mb-4">
          <div class="card-body">
            <h5 class="mb-4">Policy Sections</h5>
            
            @for (section of policySections; track section.id) {
              <div class="policy-section mb-4 pb-4 border-bottom">
                <h6 class="mb-3">{{ section.id }}. {{ section.title }}</h6>
                <p class="mb-3">{{ section.content }}</p>
                
                <div class="alert alert-light mb-2">
                  <strong>Rationale:</strong> {{ section.rationale }}
                </div>
                
                <div class="references">
                  <strong class="small text-muted">References:</strong>
                  <ul class="list-unstyled ms-3 mt-1">
                    @for (ref of section.references; track ref) {
                      <li class="small d-flex align-items-center">
                        <span class="material-symbols-rounded me-1" style="font-size: 14px;">link</span>
                        <span>{{ ref }}</span>
                      </li>
                    }
                  </ul>
                </div>
              </div>
            }
          </div>
        </div>

        <div class="alert alert-warning" role="alert">
          <strong>Note:</strong> This is a generated draft. Review and customize as needed before finalizing.
        </div>
      </div>
    }
  </div>
</div>

