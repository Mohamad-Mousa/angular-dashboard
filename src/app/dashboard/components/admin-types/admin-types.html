<div class="card border-0 shadow-sm h-100">
  <div class="card-body">
    <div class="d-flex align-items-center justify-content-between mb-4">
      <div>
        <p class="text-uppercase text-muted fw-semibold small mb-1">Roles</p>
        <h2 class="h4 mb-0">Admin Types</h2>
      </div>
      <app-button label="Create Type" size="sm" variant="primary" icon="add" [functionKey]="functionKey"
        [privilegeAccess]="writePrivilege" (click)="openCreateTypeDialog()"></app-button>
    </div>

    <app-table [columns]="columns" [rows]="tableRows()" [totalCount]="totalCount()" [showActions]="true"
      [enableFilters]="true" [enableSorting]="true" [enablePagination]="true" [loading]="tableLoading()"
      loadingLabel="Loading admin types..." [functionKey]="functionKey" [excludedActions]="excludedActions"
      [serverSideSearch]="true" [serverSideFilters]="true" [sortBy]="sortBy" [sortDirection]="sortDirection"
      (pageChange)="onPageChange($event)" (limitChange)="onLimitChange($event)" (searchChange)="onSearchChange($event)"
      (filterChange)="onFilterChange($event)" (sortChange)="onSortChange($event)" (readAction)="onRead($event)"
      (updateAction)="onUpdate($event)" (deleteAction)="onDelete($event)"></app-table>
  </div>
</div>

<app-dialog [open]="isCreateDialogOpen" [title]="dialogTitle" [description]="dialogDescription"
  width="720px" (closed)="closeCreateTypeDialog()">
  <form dialog-body [formGroup]="createTypeForm" class="form-grid">
    <label class="full-width">
      <span>Type name</span>
      <input type="text" formControlName="name" placeholder="e.g., Super Admin, Manager, etc." />
      @if (
      createTypeForm.get('name')?.invalid &&
      createTypeForm.get('name')?.touched
      ) {
      <small class="error-text">Type name is required (min 3 characters).</small>
      }
    </label>

    <div class="full-width privileges-section">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h5 class="mb-0">Privileges</h5>
        <div class="privilege-actions">
          <button type="button" class="btn-link btn-link-sm" (click)="selectAllPrivileges()">
            Select All
          </button>
          <span class="mx-2 text-muted">|</span>
          <button type="button" class="btn-link btn-link-sm" (click)="unselectAllPrivileges()">
            Unselect All
          </button>
        </div>
      </div>
      <div class="privileges-grid">
        @for (functionKey of functionKeysArray; track functionKey) {
        <div class="privilege-item">
          <div class="privilege-header">
            <strong>{{ getFunctionName(functionKey) }}</strong>
          </div>
          <div class="privilege-permissions">
            <label class="permission-checkbox">
              <input type="checkbox" [formControl]="getPrivilegeControl(functionKey, 'read')" />
              <span>Read</span>
            </label>
            <label class="permission-checkbox">
              <input type="checkbox" [formControl]="getPrivilegeControl(functionKey, 'write')" />
              <span>Write</span>
            </label>
            <label class="permission-checkbox">
              <input type="checkbox" [formControl]="getPrivilegeControl(functionKey, 'update')" />
              <span>Update</span>
            </label>
            <label class="permission-checkbox">
              <input type="checkbox" [formControl]="getPrivilegeControl(functionKey, 'delete')" />
              <span>Delete</span>
            </label>
          </div>
        </div>
        }
      </div>
    </div>
  </form>

  <div dialog-footer>
    <app-button label="Cancel" variant="text" [disabled]="createDialogLoading()"
      (clicked)="closeCreateTypeDialog()"></app-button>
    <app-button [label]="createButtonLabel" variant="primary-gradient" [loading]="createDialogLoading()"
      [disabled]="createDialogLoading()" [functionKey]="functionKey"
      [privilegeAccess]="isEditMode ? PrivilegeAccess.U : PrivilegeAccess.W" (clicked)="onCreateTypeSubmit()">
    </app-button>
  </div>
</app-dialog>

<app-dialog [open]="isDeleteDialogOpen" title="Delete admin type" description="This action cannot be undone."
  width="460px" (closed)="closeDeleteDialog()">
  <div dialog-body>
    <div class="d-flex align-items-start gap-3">
      <div class="text-danger">
        <span class="material-symbols-rounded" style="font-size: 2rem;">warning</span>
      </div>
      <div>
        <p class="fw-semibold mb-1">
          Are you sure you want to delete this admin type?
        </p>
        @if (adminTypeToDelete) {
        <p class="text-muted mb-0">
          <strong>{{ adminTypeToDelete.name }}</strong> will be permanently
          removed from the system. This action cannot be undone.
        </p>
        }
      </div>
    </div>
  </div>

  <div dialog-footer>
    <app-button label="Cancel" variant="text" [disabled]="deleteDialogLoading()"
      (clicked)="closeDeleteDialog()"></app-button>
    <app-button [label]="deleteButtonLabel" variant="danger-gradient" [loading]="deleteDialogLoading()"
      [disabled]="deleteDialogLoading()" [functionKey]="functionKey" [privilegeAccess]="deletePrivilege"
      (clicked)="confirmDelete()"></app-button>
  </div>
</app-dialog>

<app-sidebar [open]="isSidebarOpen" title="Admin Type Details" [fields]="sidebarFields" [data]="sidebarData"
  (closed)="closeSidebar()"></app-sidebar>